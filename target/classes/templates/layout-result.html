<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Layout Result</title>
    <link th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/style.css}" rel="stylesheet" />
    <style>
        .room-canvas {
            position: relative;
            border: 2px solid #333;
            background: #f8f9fa;
            margin: 0 auto;
        }
        .furniture {
            position: absolute;
            border: 1px solid #444;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            padding: 2px;
            background: rgba(0,123,255,0.08);
            border-radius: 6px;
        }
        .furniture .label {
            pointer-events: none;
            text-align: center;
        }
        .legend-item { display:flex; gap:8px; align-items:center; margin-bottom:6px; }
        .legend-swatch { width:22px; height:14px; background:#007bff; border:1px solid #444; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-start">
        <h2>Room Layout Result</h2>
        <a class="btn btn-secondary" href="/">New design</a>
    </div>

    <div class="row mt-3">
        <div class="col-lg-8">
            <div class="card mb-3">
                <div class="card-body">
                    <h5>Visualization</h5>

                    <!-- Render room canvas -->
                    <div th:with="room=${layout.room}, scale=${scale}"
                         th:if="${layout != null}">
                        <div th:attr="style=${'width:' + (room.length * scale) + 'px; height:' + (room.width * scale) + 'px;'}"
                             class="room-canvas">
                            <!-- Render each furniture item -->
                            <div th:each="fp : ${layout.placed}"
                                 th:attr="class='furniture', 
                                          style=
                                          ${'left:' + (fp.x * scale) + 'px; top:' + (fp.y * scale) + 'px; ' +
                                            'width:' + (fp.width * scale) + 'px; height:' + (fp.depth * scale) + 'px;'}">
                                <div class="label">
                                    <strong th:text="${fp.furniture.name}">Item</strong><br/>
                                    <small th:text="${fp.furniture.price + ' USD'}">Price</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:if="${layout.errors != null and layout.errors.size() > 0}" class="mt-3">
    <h6>Warnings / Placement issues</h6>
    <ul class="text-danger">
        <li th:each="e : ${layout.errors}" th:text="${e}"></li>
    </ul>
</div>


                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5>Room summary</h5>
                    <p>
                        <strong>Dimensions:</strong>
                        <span th:text="${layout.room.length + 'm (L) x ' + layout.room.width + 'm (W)'}"></span><br/>
                        <strong>Budget:</strong> <span th:text="${layout.room.budget + ' USD'}"></span>
                    </p>

                    <h6>Placed furniture</h6>
                    <table class="table table-sm">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Dimensions (m)</th>
                            <th>Price (USD)</th>
                            <th>Position (m)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="fp: ${layout.placed}">
                            <td th:text="${fp.furniture.name}"></td>
                            <td th:text="${fp.furniture.category}"></td>
                            <td th:text="${fp.width + ' x ' + fp.depth}"></td>
                            <td th:text="${fp.furniture.price}"></td>
                            <td th:text="${'x:' + #numbers.formatDecimal(fp.x,1,1) + ', y:' + #numbers.formatDecimal(fp.y,1,1)}"></td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>

        </div>

        <div class="col-lg-4">
            <div class="card mb-3 p-3">
                <h5>Cost & Budget</h5>
                <p><strong>Total cost:</strong> <span th:text="${layout.totalCost + ' USD'}">0 USD</span></p>
                <p><strong>Remaining:</strong> <span th:text="${layout.remainingBudget + ' USD'}">0 USD</span></p>
            </div>

            <div class="card p-3">
                <h5>Legend</h5>
                <div class="legend-item"><div class="legend-swatch"></div>Example furniture tile</div>
                <small class="text-muted">This is a simple schematic. Units are meters; visualization uses a scale (pixels per meter).</small>
            </div>
        </div>
    </div>

</div>

<script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
